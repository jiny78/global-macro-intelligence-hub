# 전문가급 PDF 리포팅 시스템 가이드

## 시스템 개요

Global Macro Intelligence Hub의 **전문가급 PDF 리포팅 및 지능형 메일 전송 시스템**은 단순한 보고서 생성을 넘어, AI의 한계를 명시하고 투자자에게 객관적인 정보를 제공하는 혁신적인 시스템입니다.

---

## 핵심 특징

### 1. 한글 폰트 자동 탐지
- 시스템에 설치된 한글 폰트를 자동으로 탐지
- 우선 순위: 나눔고딕 → 맑은 고딕 → 나눔바른고딕 → 굴림
- 폰트가 없어도 영문으로 정상 작동

### 2. 4-Section 전문가급 레이아웃

#### Section 1: 데이터 기반 팩트 체크
- 공시 데이터 분석
- 뉴스 헤드라인 요약
- 주가 추이 및 기술적 지표
- 차트 이미지 포함

#### Section 2: Claude의 비판적 분석
- 데이터-내러티브 괴리 분석
- 공시 진위 판별
- 강세론 vs 약세론 (5:5 균형)
- 확증 편향 제거

#### Section 3: 기술적 지표 요약
- RSI, 이동평균선, 거래량 분석
- 골든크로스/데드크로스 감지
- 과매수/과매도 구간 판별

#### Section 4: AI 자기 비판 (필수)
**이 섹션이 핵심입니다!**
- AI의 근본적인 한계 명시
- 데이터 불완전성 경고
- 시점 차이 문제 지적
- 할루시네이션 가능성 공개
- 맥락 부족 인정
- 감정과 편향 가능성 표명

### 3. AI 리스크 스코어
- 0-100점 척도
- 부정적 키워드 가중치 반영
- 긍정적 키워드 가중치 반영
- 신뢰도 점수 통합

### 4. HTML 지능형 메일
- 전문적인 그라디언트 디자인
- 3-line 핵심 요약 (불릿 포인트)
- 리스크 레벨 배지 (Low/Medium/High)
- AI Risk Score 강조 표시
- PDF 파일 자동 첨부

---

## 사용 방법

### 1. 앱 실행
```bash
cd "C:\Users\User\Projects\Global Macro Intelligence Hub"
streamlit run app.py
```

또는 바탕화면의 `run_analyzer.bat` 더블클릭

### 2. 종목 분석
1. 스크리닝 결과에서 관심 종목 확인
2. **"🤖 클로드 비판 분석 시작"** 버튼 클릭
3. AI 분석 결과 확인

### 3. PDF 리포트 생성 및 전송
1. **"🎯 전문가급 PDF 리포트 생성 및 전송"** 버튼 클릭
2. 14단계 진행 상황 확인:
   - 📄 PDF 문서 초기화
   - 📝 표지 생성
   - 📊 섹션 1: 데이터 팩트 체크
   - 📈 차트 이미지 생성
   - 🤖 섹션 2: AI 비판적 분석
   - 📉 섹션 3: 기술적 지표 요약
   - ⚠️ 섹션 4: AI 자기 비판 (필수)
   - 📄 면책 조항 추가
   - 💾 PDF 파일 저장
   - 📧 이메일 준비
   - 📎 PDF 첨부
   - 🎨 HTML 본문 생성
   - 📮 SMTP 연결
   - ✅ 이메일 전송 완료

### 4. 이메일 수신
- 받는 사람: `.env`의 `RECIPIENT_EMAIL`
- 제목: `[Global Macro] report_종목명_날짜시간.pdf`
- 본문:
  - 📊 AI Risk Score: XX/100
  - 🎯 핵심 요약 (3가지)
  - 📎 PDF 첨부 파일

---

## 리포트 구성 상세

### PDF 파일 구조

```
┌─────────────────────────────────────────┐
│  GLOBAL MACRO INTELLIGENCE              │
│  Professional Critical Analysis Report  │
├─────────────────────────────────────────┤
│                                         │
│  [Overview]                             │
│  • 회사명: 삼성전자                      │
│  • 티커: 005930                         │
│  • 리포트 생성: 2026-02-05              │
│  • 분석 모델: Claude Sonnet 4           │
│                                         │
├─────────────────────────────────────────┤
│  Section 1: Data-Based Fact Check       │
├─────────────────────────────────────────┤
│  • 공시 정보                             │
│  • 뉴스 헤드라인                         │
│  • 주가 추이                             │
│  [차트 이미지]                           │
│                                         │
├─────────────────────────────────────────┤
│  Section 2: Claude Critical Analysis    │
├─────────────────────────────────────────┤
│  • 데이터-내러티브 괴리                  │
│  • 공시 진위 판별                        │
│  • 강세론 vs 약세론                      │
│  • 신뢰도 점수: XX/100                  │
│                                         │
├─────────────────────────────────────────┤
│  Section 3: Technical Indicators        │
├─────────────────────────────────────────┤
│  • RSI: XX                              │
│  • MA(5/20/60)                          │
│  • 거래량 분석                           │
│                                         │
├─────────────────────────────────────────┤
│  Section 4: AI SELF-CRITICISM ⚠️        │
├─────────────────────────────────────────┤
│  이 리포트는 AI가 생성한 것으로,         │
│  다음과 같은 근본적인 한계를 가집니다:   │
│                                         │
│  1. 데이터 불완전성                      │
│     - 7일 데이터만 사용                  │
│     - 공시 전체 내용 미확인              │
│                                         │
│  2. 시점 차이 문제                       │
│     - 데이터 수집 시점과 현재 시점 차이  │
│                                         │
│  3. AI 할루시네이션 가능성               │
│     - 존재하지 않는 패턴 인식 가능       │
│                                         │
│  4. 맥락 부족                            │
│     - 산업 전체 맥락 미고려              │
│                                         │
│  5. 감정과 편향                          │
│     - 학습 데이터의 편향 반영 가능       │
│                                         │
│  ⚠️ 투자 결정 시 반드시 전문가 상담 필요 │
│                                         │
├─────────────────────────────────────────┤
│  Disclaimer                             │
├─────────────────────────────────────────┤
│  본 리포트는 투자 권유가 아닙니다.       │
│  투자 판단은 본인의 책임입니다.          │
└─────────────────────────────────────────┘
```

---

## HTML 이메일 구조

```html
┌─────────────────────────────────────────┐
│  GLOBAL MACRO INTELLIGENCE REPORT       │
│  [그라디언트 헤더]                       │
├─────────────────────────────────────────┤
│                                         │
│  안녕하세요,                             │
│                                         │
│  종목: 삼성전자 (005930)                 │
│  생성 시간: 2026-02-05 14:30:00         │
│                                         │
│  [리스크 배지]                           │
│  🔴 High Risk  / 🟡 Medium / 🟢 Low     │
│                                         │
│  AI Risk Score: 72/100                  │
│                                         │
├─────────────────────────────────────────┤
│  📋 핵심 요약 (Key Summary)              │
├─────────────────────────────────────────┤
│  • 공시 분석: ...                        │
│  • 기술적 지표: RSI 과매수 구간          │
│  • AI 자기 비판: 데이터 불완전성 경고    │
│                                         │
├─────────────────────────────────────────┤
│  📎 첨부 파일                            │
├─────────────────────────────────────────┤
│  report_삼성전자_20260205_143000.pdf    │
│  (약 500KB)                             │
│                                         │
├─────────────────────────────────────────┤
│  ⚠️ 투자 유의사항                        │
├─────────────────────────────────────────┤
│  • AI가 생성한 분석입니다                │
│  • 데이터 한계가 있습니다                │
│  • 투자 결정 시 전문가 상담 필수         │
│                                         │
│  Powered by Claude Sonnet 4             │
└─────────────────────────────────────────┘
```

---

## AI 자기 비판 섹션 - 왜 필수인가?

### 1. 투명성 (Transparency)
AI가 자신의 한계를 명시함으로써 투자자가 정보를 맹신하지 않도록 보호

### 2. 책임성 (Accountability)
AI 생성 콘텐츠의 법적 리스크 경감

### 3. 윤리성 (Ethics)
"AI가 모든 것을 안다"는 잘못된 인식 방지

### 4. 실용성 (Practicality)
투자자가 추가 검증이 필요한 부분을 명확히 인지

---

## 리스크 스코어 계산 로직

```python
기본 점수: 50점

부정적 키워드 (+10점):
- 위험, 하락, 악재, 우려, 부정적, 감소, 실적 악화,
  매출 감소, 적자, 손실, 규제, 소송, 불확실성

긍정적 키워드 (-5점):
- 상승, 호재, 긍정적, 증가, 강세, 실적 개선,
  매출 증가, 흑자, 수익, 성장, 혁신

신뢰도 점수 반영:
- 신뢰도가 낮으면 리스크 증가
- risk_score += (100 - reliability_score) * 0.2

최종 범위: 0-100점
```

### 리스크 레벨 분류
- **Low Risk (0-40점)**: 🟢 녹색 배지
- **Medium Risk (41-70점)**: 🟡 노란색 배지
- **High Risk (71-100점)**: 🔴 빨간색 배지

---

## 기술 스펙

### 시스템 요구사항
- Python 3.8+
- Windows 10/11 (한글 폰트 자동 탐지)
- Gmail 계정 (앱 비밀번호 필요)

### 주요 라이브러리
- `fpdf2>=2.7.0`: PDF 생성
- `Pillow>=10.0.0`: 이미지 처리
- `plotly>=5.18.0`: 차트 생성
- `kaleido>=0.2.1`: 차트 → 이미지 변환
- `anthropic>=0.40.0`: Claude API
- `smtplib`: 이메일 전송 (Python 표준 라이브러리)

### 파일 구조
```
reports/
├── report_삼성전자_20260205_143000.pdf
├── report_SK하이닉스_20260205_150000.pdf
└── ...

data/
├── 005930_data.json
└── ...
```

---

## 문제 해결

### PDF 생성 실패
**증상**: "폰트를 찾을 수 없습니다"

**해결**:
1. Windows 폰트 폴더 확인: `C:\Windows\Fonts`
2. 나눔고딕 설치: https://hangeul.naver.com/font
3. 시스템 재시작

### 이메일 전송 실패
**증상**: "Authentication failed"

**해결**:
1. `.env` 파일의 `APP_PASSWORD` 확인
2. 공백 제거 확인 (자동 처리됨)
3. Gmail 앱 비밀번호 재생성
4. `EMAIL_SETUP.md` 참조

### 차트 이미지 생성 실패
**증상**: "Failed to export chart"

**해결**:
1. kaleido 재설치: `pip install -U kaleido`
2. Chrome/Chromium 설치 확인
3. 관리자 권한으로 실행

---

## 고급 활용

### 1. 여러 종목 배치 처리
```python
# 향후 기능 (현재 미구현)
tickers = ['005930', '000660', '035420']
for ticker in tickers:
    # 각 종목 분석 및 PDF 생성
    pass
```

### 2. 이메일 템플릿 커스터마이징
`report_manager.py`의 `create_html_email()` 메서드에서 HTML 수정 가능

### 3. PDF 레이아웃 조정
`ProfessionalPDFReport` 클래스의 메서드 수정:
- `section_header()`: 섹션 헤더 스타일
- `add_bullet_text()`: 불릿 포인트 형식
- `header()`: 페이지 헤더
- `footer()`: 페이지 푸터

---

## 법적 고지

### 면책 조항
본 시스템은 **투자 자문이 아니며**, 교육 및 정보 제공 목적입니다.

### AI 한계 명시
모든 리포트에는 **Section 4: AI Self-Criticism**이 포함되어 AI의 한계를 명확히 공개합니다.

### 투자 책임
투자 판단과 그에 따른 손익은 전적으로 투자자 본인의 책임입니다.

---

## 체크리스트

시스템 사용 전 확인:
- [ ] Python 가상 환경 활성화
- [ ] `.env` 파일 설정 완료
- [ ] Gmail 앱 비밀번호 생성
- [ ] 한글 폰트 설치 (선택)
- [ ] 첫 테스트 실행 성공

리포트 검토 시 확인:
- [ ] Section 1: 데이터 팩트 체크
- [ ] Section 2: Claude 비판적 분석
- [ ] Section 3: 기술적 지표
- [ ] **Section 4: AI 자기 비판 (필수!)**
- [ ] 차트 이미지 포함
- [ ] 이메일 수신 확인

---

## 추가 자료

- **이메일 설정**: `EMAIL_SETUP.md`
- **전체 설치 가이드**: `SETUP.md`
- **사용법**: `USAGE.md`
- **빠른 시작**: `QUICKSTART.md`

---

## 기술 지원

**GitHub Issues**: (프로젝트 GitHub 주소)

**문의사항**:
- 이메일 설정 문제 → `EMAIL_SETUP.md` 참조
- PDF 생성 문제 → 이 가이드 "문제 해결" 섹션 참조
- API 키 문제 → `.env.example` 참조

---

**이제 전문가급 PDF 리포트를 생성하고 이메일로 받을 준비가 완료되었습니다!**

**핵심 차별점:**
1. **AI가 스스로 한계를 인정** (Section 4)
2. **리스크 스코어 투명 공개**
3. **HTML 지능형 메일** (단순 텍스트 아님)
4. **14단계 실시간 진행 상황 표시**

---

*Generated by Claude Sonnet 4*
*Global Macro Intelligence Hub v2.0*
